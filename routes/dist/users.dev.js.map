{"version":3,"sources":["users.js"],"names":["express","require","router","Router","User","bcrypt","pageRegister","pagetitle","pageheading","pagemessage","hideLogin","get","req","res","next","render","post","user","body","errs","validateSync","processErrors","hash","password","err","hashedPassword","save","result","headermessage","fname","redirect","errorArray","errorKeys","Object","keys","errors","forEach","key","push","message","module","exports"],"mappings":";;;;;;;;AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,MAAM,GAAGF,OAAO,CAACG,MAAR,EAAb;;eACiBF,OAAO,CAAC,gBAAD,C;IAAhBG,I,YAAAA,I;;AACR,IAAMC,MAAM,GAAGJ,OAAO,CAAC,UAAD,CAAtB;;AAEA,IAAMK,YAAY,GAAG;AACnBC,EAAAA,SAAS,EAAE,SADQ;AAEnBC,EAAAA,WAAW,EAAE,sBAFM;AAGnBC,EAAAA,WAAW,EAAE,gEAHM;AAInBC,EAAAA,SAAS,EAAE;AAJQ,CAArB,C,CAMA;AACA;AACA;AACA;AACA;;AAEA;;AACAR,MAAM,CAACS,GAAP,CAAW,GAAX,EAAgB,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AACxCD,EAAAA,GAAG,CAACE,MAAJ,CAAW,UAAX,EAAuBT,YAAvB;AACD,CAFD;AAIAJ,MAAM,CAACc,IAAP,CAAY,GAAZ,EAAiB,UAAUJ,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AACzC;AACA,MAAMG,IAAI,GAAG,IAAIb,IAAJ,CAASQ,GAAG,CAACM,IAAb,CAAb;AACA,MAAMC,IAAI,GAAGF,IAAI,CAACG,YAAL,EAAb,CAHyC,CAGP;;AAClC,MAAID,IAAJ,EAAU;AACR,WAAOE,aAAa,CAACF,IAAD,EAAOP,GAAP,EAAYC,GAAZ,CAApB;AACD;;AACDR,EAAAA,MAAM,CAACiB,IAAP,CAAYV,GAAG,CAACM,IAAJ,CAASK,QAArB,EAA+B,EAA/B,EAAmC,UAACC,GAAD,EAAMC,cAAN,EAAyB;AAC1D,QAAID,GAAJ,EAAS,MAAMA,GAAN,CADiD,CAE1D;;AACAP,IAAAA,IAAI,CAACM,QAAL,GAAgBE,cAAhB,CAH0D,CAI1D;;AACAR,IAAAA,IAAI,CAACS,IAAL,CAAU,UAACF,GAAD,EAAMG,MAAN,EAAiB;AACzB,UAAIH,GAAJ,EAAS;AACP,eAAOH,aAAa,CAACG,GAAD,EAAMZ,GAAN,EAAWC,GAAX,CAApB;AACD,OAHwB,CAIzB;;;AACA,UAAMe,aAAa,6BAAsBD,MAAM,CAACE,KAA7B,CAAnB;AACAhB,MAAAA,GAAG,CAACiB,QAAJ,CAAa,qBAAqBF,aAAlC;AACD,KAPD;AAQD,GAbD;AAcD,CArBD;;AAuBA,SAASP,aAAT,CAAuBF,IAAvB,EAA6BP,GAA7B,EAAkCC,GAAlC,EAAuC;AACrC;AACA,MAAMkB,UAAU,GAAG,EAAnB;AACA,MAAMC,SAAS,GAAGC,MAAM,CAACC,IAAP,CAAYf,IAAI,CAACgB,MAAjB,CAAlB;AACAH,EAAAA,SAAS,CAACI,OAAV,CAAkB,UAACC,GAAD;AAAA,WAASN,UAAU,CAACO,IAAX,CAAgBnB,IAAI,CAACgB,MAAL,CAAYE,GAAZ,EAAiBE,OAAjC,CAAT;AAAA,GAAlB;AACA,SAAO1B,GAAG,CAACE,MAAJ,CAAW,SAAX,oBACFT,YADE;AAEL6B,IAAAA,MAAM,EAAEJ;AAFH,KAGFnB,GAAG,CAACM,IAHF,EAAP;AAKD;;AAEDsB,MAAM,CAACC,OAAP,GAAiBvC,MAAjB","sourcesContent":["var express = require(\"express\");\nvar router = express.Router();\nconst { User } = require(\"../models/user\");\nconst bcrypt = require(\"bcryptjs\");\n\nconst pageRegister = {\n  pagetitle: \"Sign-Up\",\n  pageheading: \"Create a new account\",\n  pagemessage: \"Please enter the required information to create a new account.\",\n  hideLogin: true,\n};\n// const pageShowPosts = {\n//   pagetitle: \"Blog posts\",\n//   pageheading: \"List all posts\",\n//   pagemessage: \"These are all postets.\",\n// };\n\n/* Sign-up page. */\nrouter.get(\"/\", function (req, res, next) {\n  res.render(\"/sign-up\", pageRegister);\n});\n\nrouter.post(\"/\", function (req, res, next) {\n  // Create a new user object from the User Model\n  const user = new User(req.body);\n  const errs = user.validateSync(); // Run the model validation\n  if (errs) {\n    return processErrors(errs, req, res);\n  }\n  bcrypt.hash(req.body.password, 10, (err, hashedPassword) => {\n    if (err) throw err;\n    // Replace the plain password with the hashed password\n    user.password = hashedPassword;\n    // Store the use object in the DB\n    user.save((err, result) => {\n      if (err) {\n        return processErrors(err, req, res);\n      }\n      //console.log(result);\n      const headermessage = `Account created ${result.fname}`;\n      res.redirect(\"/?headermessage=\" + headermessage);\n    });\n  });\n});\n\nfunction processErrors(errs, req, res) {\n  // If there are errors from the Model schema\n  const errorArray = [];\n  const errorKeys = Object.keys(errs.errors);\n  errorKeys.forEach((key) => errorArray.push(errs.errors[key].message));\n  return res.render(\"sign-up\", {\n    ...pageRegister,\n    errors: errorArray,\n    ...req.body,\n  });\n}\n\nmodule.exports = router;\n"],"file":"users.dev.js"}