{"version":3,"sources":["index.js"],"names":["express","require","router","Router","mongo","MongoClient","uniqueValidator","Packages","Booking1","myarray","getPackages","pid","callback","connect","process","env","MONGO_URL","useNewUrlParser","useUnifiedTopology","err","client","db","collection","query","packid","find","toArray","items","get","req","res","next","packdata","greet","Math","floor","random","length","greetings","console","log","render","mypackages","greet_msg","date_time","Date","toString","params","packageid","data","isdetails","post","body","booking1","userId","packageId","TravellerCount","save","processErrors","redirect","populate","exec","bookingid","findOneAndDelete","_id","module","exports"],"mappings":"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","sourcesContent":["var express = require('express');\nvar router = express.Router();\nconst mongo = require(\"mongodb\").MongoClient;\nconst uniqueValidator = require(\"mongoose-unique-validator\");\nconst { Packages } = require(\"../models/packages\");\nconst { Booking1 } = require(\"../models/booking1\");\n\n// Generate random Greeting Program\nvar myarray = ['ready for some exciting time', 'how are you today', 'good to see you', 'hope you are having a good day']\n\n\nfunction getPackages(pid, callback) {\n  mongo.connect(process.env.MONGO_URL, {  // Create the DB connection\n    useNewUrlParser: true,\n    useUnifiedTopology: true\n  },\n    (err, client) => {  // The callback will be called if the connection was succeded\n      if (err) { throw err; }\n      const db = client.db(\"userdata\");  // get reference to the DB\n      const collection = db.collection(\"packages\"); // Get reference to the collection\n      const query = {}    // Empty query to get all data\n      if (pid) query.packid = (pid);  // If you need certain product\n      collection.find(query).toArray((err, items) => {\n        // console.log(query)\n        // if (err) { throw err; }\n        \n        // code goes here\n        // console.log(items)\n        callback(err, items)\n      });\n\n    }\n  );\n  }\n\n\n/* GET all packages listing. */\n\nrouter.get('/', function (req, res, next) {\n  // Read the packages list from the DB\n  getPackages(null, // null => get all packages\n    function (err, packdata) { // Callback function, will be called when the data from the DB is ready\n      if (err) throw err\n      const greet = Math.floor(Math.random() * myarray.length);\n      var greetings = myarray[greet];\n      console.log(myarray[greet]);\n      // Render the PUG template with the product data we got from the DB\n       res.render('index', {\n        mypackages: packdata,\n        greet_msg: ('Welcome to our travel Portal, '+greetings ),\n        date_time: (new Date()).toString(),\n      });\n    }\n  );\n});\n\n/* GET one product listing. */\n\nrouter.get('/details/det/:packageid', function (req, res, next) {\n  const packid = req.params.packageid\n  console.log(packid);\n  getPackages(packid,\n    function (err, data) {\n \n      if (err) throw err\n      res.render('det', {\n        mypackages: data,\n        isdetails: true,  \n      });\n    }\n  );\n});\n\n// middleware that is specific to this router,\n// checks that the user must be logged in\n// router.use((req, res, next) => {\n//   console.log('Time: ', Date.now());\n//   if (!req.user) res.status(403).redirect(\"/signup\");\n//   //else if (req.user.role != \"agent\") res.status(403).redirect(\"/\");\n//   else next();\n// });\n\n// load booking data\nrouter.post(\"/book\", function (req, res, next) {\n  const data = req.body;\n  const booking1 = new Booking1();\n  booking1.userId = 3;\n  booking1.packageId = req.body.packageId;\n  booking1.TravellerCount = req.body.TravellerCount;\n  console.log(booking1.packageId);\n  booking1.save(function (err) {\n    if (err) return processErrors(err, \"det\", req, res, req.body);\n    res.redirect(\"/book1\");\n  });\n});\n\n/* GET the purchases page. */\nrouter.get(\"/book1\", function (req, res, next) {\n  Booking1.find({ userId: 3 })\n    // Replace the productId with the corresponding product object from the products collection(table)\n    //console.log(Booking1)\n    .populate(\"packageId\")\n    .exec((err, booking1) => {\n      if (err) console.log(err);\n      res.render(\"book1\", { booking1 });\n    });\n});\n\n/* Process the product return, sent as GET request, for the given product Id. */\nrouter.get(\"/return/:bookingid\", function (req, res, next) {\n  const bookingid = req.params.bookingid;\n  Booking1.findOneAndDelete({ _id: bookingid }, (err) => {\n    if (err) console.log(err);\n    res.redirect(\"/\"); // Redirect to the purchases page\n  });\n});\n\nmodule.exports = router;\n\n\n\n"],"file":"index.dev.js"}