{"version":3,"sources":["index.js"],"names":["express","require","router","Router","mongo","MongoClient","uniqueValidator","Packages","Booking1","myarray","checkAuthenticated","req","res","next","isAuthenticated","redirect","getPackages","pid","callback","connect","process","env","MONGO_URL","useNewUrlParser","useUnifiedTopology","err","client","db","collection","query","packid","find","toArray","items","get","packdata","greet","Math","floor","random","length","greetings","console","log","render","mypackages","greet_msg","date_time","Date","toString","params","packageid","data","isdetails","post","body","booking1","userId","user","packageId","TravellerCount","save","processErrors","populate","exec","bookingid","findOneAndDelete","_id","module","exports"],"mappings":"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","sourcesContent":["var express = require('express');\nvar router = express.Router();\nconst mongo = require(\"mongodb\").MongoClient;\nconst uniqueValidator = require(\"mongoose-unique-validator\");\nconst { Packages } = require(\"../models/packages\");\nconst { Booking1 } = require(\"../models/booking1\");\n\n// Generate random Greeting Program\nvar myarray = ['ready for some exciting time', 'how are you today', 'good to see you', 'hope you are having a good day']\n\nfunction checkAuthenticated(req, res, next){\n  if (req.isAuthenticated()){ \n    return next()\n  }\n  res.redirect ('/signup')\n}\n\n\nfunction getPackages(pid, callback) {\n  mongo.connect(process.env.MONGO_URL, {  // Create the DB connection\n    useNewUrlParser: true,\n    useUnifiedTopology: true\n  },\n    (err, client) => {  // The callback will be called if the connection was succeded\n      if (err) { throw err; }\n      const db = client.db(\"userdata\");  // get reference to the DB\n      const collection = db.collection(\"packages\"); // Get reference to the collection\n      const query = {}    // Empty query to get all data\n      if (pid) query.packid = (pid);  // If you need certain product\n      collection.find(query).toArray((err, items) => {\n        // console.log(query)\n        // if (err) { throw err; }\n        \n        // code goes here\n        // console.log(items)\n        callback(err, items)\n      });\n\n    }\n  );\n  }\n\n\n/* GET all packages listing. */\n\nrouter.get('/', function (req, res, next) {\n  // Read the packages list from the DB\n  getPackages(null, // null => get all packages\n    function (err, packdata) { // Callback function, will be called when the data from the DB is ready\n      if (err) throw err\n      const greet = Math.floor(Math.random() * myarray.length);\n      var greetings = myarray[greet];\n      console.log(myarray[greet]);\n      // Render the PUG template with the product data we got from the DB\n       res.render('index', {\n        mypackages: packdata,\n        greet_msg: ('Welcome to our travel Portal, '+greetings),\n        date_time: (new Date()).toString(),\n        \n      });\n    }\n  );\n});\n\n/* GET one product listing. */\n\nrouter.get('/details/det/:packageid', function (req, res, next) {\n  const packid = req.params.packageid\n  console.log(packid);\n  getPackages(packid,\n    function (err, data) {\n \n      if (err) throw err\n      res.render('det', {\n        mypackages: data,\n        isdetails: true,  \n      });\n    }\n  );\n});\n\n// load booking data\nrouter.post(\"/book\", function (req, res, next) {\n  const data = req.body;\n  const booking1 = new Booking1();\n  booking1.userId = (req.user);\n  booking1.packageId = req.body.packageId;\n  booking1.TravellerCount = req.body.TravellerCount;\n  console.log(booking1.packageId);\n  booking1.save(function (err) {\n    if (err) return processErrors(err, \"det\", req, res, req.body);\n    res.redirect(\"book1\");\n  });\n});\n\n/* GET the purchases page. */\nrouter.get(\"/book1\", function (req, res, next) {\n  Booking1.find({ userId: (req.user) })\n    // Replace the productId with the corresponding product object from the products collection(table)\n    //console.log(Booking1)\n    .populate(\"packageId\")\n    .exec((err, booking1) => {\n      if (err) console.log(err);\n      res.render(\"book1\", { booking1 });\n    });\n});\n\n/* Process the product return, sent as GET request, for the given product Id. */\nrouter.get(\"/return/:bookingid\", function (req, res, next) {\n  const bookingid = req.params.bookingid;\n  Booking1.findOneAndDelete({ _id: bookingid }, (err) => {\n    if (err) console.log(err);\n    res.redirect(\"/\"); // Redirect to the purchases page\n  });\n});\n\nmodule.exports = router;\n\n\n\n"],"file":"index.dev.js"}