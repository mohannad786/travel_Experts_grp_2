{"version":3,"sources":["index.js"],"names":["express","require","router","Router","MongoClient","uniqueValidator","Booking1","Packages","pid","mongo","connect","process","env","MONGO_URL","useNewUrlParser","err","client","myarray","getPackages","db","callback","query","packid","toArray","items","collection","find","req","next","packdata","floor","Math","random","length","greetings","greet","console","log","res","render","mypackages","greet_msg","get","Date","params","packageid","data","isdetails","post","body","booking1","userId","packageId","TravellerCount","save","processErrors","redirect","populate","exec","bookingid"],"mappings":"aAAA,IAAIA,QAAUC,QAAQ,WAClBC,OAASF,QAAQG,SADjBH,MAAUC,QAAQ,WAAtBG,YAGMC,gBAAkBJ,QAAQ,sCAFXE,QAArB,sBAAID,kBAAAA,mBAIiBD,QAAQ,sBAArBK,mBAAAA,SAFFD,QAAAA,CAAAA,+BAA0B,oBAAhC,kBAAA,kCAQA,SAPQE,YAOaC,EAPbD,GAQNE,MAAMC,QAAQC,QAAQC,IAAIC,UAAW,CACnCC,iBARiBb,EAAbK,oBASgB,GAEpB,SAACS,EAAKC,GARNC,GAAAA,EAAW,MAAAF,EAUT,IAPGG,EAOQF,EAAOG,GAAG,YAPDC,WAAU,YAC5BV,EAAQC,GAA0BH,IAAAa,EAAAC,OAAAd,GACtCM,EAAAA,KAAiBO,GADkBE,QAAA,SAAAR,EAAAS,GAKVJ,EAAAL,EAAAS,OAKvBC,OAAAA,IAAAA,IAAWC,SAAXC,EAAuBJ,EAAQK,GAE7BV,YAAA,KAEA,SAAAH,EAAAc,GACA,GAAAd,EAAA,MAAAA,EACAK,IAAAA,EAAcI,KAANM,MAARC,KAAAC,SAAAf,QAAAgB,QANFC,EAAAjB,QAAAkB,GAVJC,QAAAC,IAAApB,QAAAkB,IAwBFG,EAAAC,OAAA,QAAA,CAYQC,WAAYX,EACZY,UAAY,iCAAiCP,EAX9CQ,WAAS,IAAAC,MAAeL,iBAOzBF,OAAAA,IAAO,0BACP,SAAAT,EAAAW,EAAAV,GAaJ,IAAMN,EAASK,EAAIiB,OAAOC,UAZrBP,QAAIC,IAAJjB,GACCkB,YAAAA,EACAC,SAAAA,EAAYK,GAFb,GAAA/B,EAAA,MAAAA,EAPLuB,EAAAC,OAAA,MAAA,CAFFC,WAAAM,EAkBAC,WAAA,QAqBA7C,OAAA8C,KAAA,QAAA,SAAArB,EAAAW,EAAAV,GACAD,EAAAsB,KAAA,IACAC,EAAA,IAAA5C,SACA4C,EAAAC,OAAA,EAEAD,EAAAE,UAAAzB,EAAAsB,KAAAG,UAMEF,EAASG,eAAiB1B,EAAIsB,KAAKI,eALrCnD,QAAO8C,IAAKE,EAASE,WACnBF,EAAUI,KAAM,SAAhBvC,GACA,GAAMmC,EAAAA,OAAWK,cAAjBxC,EAAA,MAAAY,EAAAW,EAAAX,EAAAsB,MACAC,EAAAA,SAAA,cAKEhD,OAAAwC,IAAA,SAAgBa,SAAAA,EAAcxC,EAAKa,GACnCU,SAAIkB,KAAJ,CAAaL,OAAb,IAIJM,SAAA,aAMKC,KAAK,SAAC3C,EAAKmC,GALhBnC,GAAWqB,QAAUC,IAAAtB,GACnBT,EAAQiC,OAAM,QAAA,CAAAW,SAAAA,QAKVhD,OAAAwC,IAAA,qBAAS,SAAAf,EAAAW,EAAAV,GACTU,IAAIC,EAAOZ,EAASiB,OAAAe,UAAET,SAAAA,iBAAAA,CAAAA,IAAAA,GAAAA,SAAAA,GAAtBnC,GAAAqB,QAAAC,IAAAtB,GANJuB,EAAAkB,SAAA,SAWFtD,OAAOwC,QAAIxC","file":"index.min.js","sourcesContent":["var express = require('express');\nvar router = express.Router();\nconst mongo = require(\"mongodb\").MongoClient;\nconst uniqueValidator = require(\"mongoose-unique-validator\");\nconst { Packages } = require(\"../models/packages\");\nconst { Booking1 } = require(\"../models/booking1\");\n\n// Generate random Greeting Program\nvar myarray = ['ready for some exciting time', 'how are you today', 'good to see you', 'hope you are having a good day']\n\n\nfunction getPackages(pid, callback) {\n  mongo.connect(process.env.MONGO_URL, {  // Create the DB connection\n    useNewUrlParser: true,\n    useUnifiedTopology: true\n  },\n    (err, client) => {  // The callback will be called if the connection was succeded\n      if (err) { throw err; }\n      const db = client.db(\"userdata\");  // get reference to the DB\n      const collection = db.collection(\"packages\"); // Get reference to the collection\n      const query = {}    // Empty query to get all data\n      if (pid) query.packid = (pid);  // If you need certain product\n      collection.find(query).toArray((err, items) => {\n        // console.log(query)\n        // if (err) { throw err; }\n        \n        // code goes here\n        // console.log(items)\n        callback(err, items)\n      });\n\n    }\n  );\n  }\n\n\n/* GET all packages listing. */\n\nrouter.get('/', function (req, res, next) {\n  // Read the packages list from the DB\n  getPackages(null, // null => get all packages\n    function (err, packdata) { // Callback function, will be called when the data from the DB is ready\n      if (err) throw err\n      const greet = Math.floor(Math.random() * myarray.length);\n      var greetings = myarray[greet];\n      console.log(myarray[greet]);\n      // Render the PUG template with the product data we got from the DB\n       res.render('index', {\n        mypackages: packdata,\n        greet_msg: ('Welcome to our travel Portal, '+greetings ),\n        date_time: (new Date()).toString(),\n      });\n    }\n  );\n});\n\n/* GET one product listing. */\n\nrouter.get('/details/det/:packageid', function (req, res, next) {\n  const packid = req.params.packageid\n  console.log(packid);\n  getPackages(packid,\n    function (err, data) {\n \n      if (err) throw err\n      res.render('det', {\n        mypackages: data,\n        isdetails: true,  \n      });\n    }\n  );\n});\n\n// middleware that is specific to this router,\n// checks that the user must be logged in\n// router.use((req, res, next) => {\n//   console.log('Time: ', Date.now());\n//   if (!req.user) res.status(403).redirect(\"/signup\");\n//   //else if (req.user.role != \"agent\") res.status(403).redirect(\"/\");\n//   else next();\n// });\n\n// load booking data\nrouter.post(\"/book\", function (req, res, next) {\n  const data = req.body;\n  const booking1 = new Booking1();\n  booking1.userId = 3;\n  booking1.packageId = req.body.packageId;\n  booking1.TravellerCount = req.body.TravellerCount;\n  console.log(booking1.packageId);\n  booking1.save(function (err) {\n    if (err) return processErrors(err, \"det\", req, res, req.body);\n    res.redirect(\"/book1\");\n  });\n});\n\n/* GET the purchases page. */\nrouter.get(\"/book1\", function (req, res, next) {\n  Booking1.find({ userId: 3 })\n    // Replace the productId with the corresponding product object from the products collection(table)\n    //console.log(Booking1)\n    .populate(\"packageId\")\n    .exec((err, booking1) => {\n      if (err) console.log(err);\n      res.render(\"book1\", { booking1 });\n    });\n});\n\n/* Process the product return, sent as GET request, for the given product Id. */\nrouter.get(\"/return/:bookingid\", function (req, res, next) {\n  const bookingid = req.params.bookingid;\n  Booking1.findOneAndDelete({ _id: bookingid }, (err) => {\n    if (err) console.log(err);\n    res.redirect(\"/\"); // Redirect to the purchases page\n  });\n});\n\nmodule.exports = router;\n\n\n\n"]}