"use strict";var passport=require("passport"),bcrypt=require("bcryptjs"),LocalStrategy=require("passport-local").Strategy;module.exports.init=function(e){e.use(require("express-session")({secret:process.env.PASSPORT_SECRET||"wserjoifjpsiofjfsdfs",resave:!0,saveUninitialized:!0}));var t=require("./models/user").User;console.log(t),passport.use(new LocalStrategy(function(e,r,o){t.findOne({username:e},function(e,s){return e?o(e):s?void bcrypt.compare(r,s.password,function(e,r){return r?o(null,s):o(null,!1,{msg:"Incorrect password"})}):o(null,!1)})})),passport.serializeUser(function(e,r){r(null,e.id)}),passport.deserializeUser(function(e,s){t.findById(e,function(e,r){s(e,r)})}),e.use(passport.initialize()),e.use(passport.session()),e.post("/login",function(o,t,n){passport.authenticate("local",function(e,r,s){return e?n(e):r?void o.logIn(r,function(e){return e?(t.locals.errors=["Login failed"],n(e)):t.redirect("/")}):t.redirect("/signup")})(o,t,n)}),e.use(function(e,r,s){r.locals.currentUser=e.user,s()}),e.get("/log-out",function(e,r){e.logout(),r.redirect("/")})};
//# sourceMappingURL=my-passport.min.js.map
