"use strict";var passport=require("passport"),bcrypt=require("bcryptjs"),LocalStrategy=require("passport-local").Strategy;module.exports.init=function(e){e.use(require("express-session")({secret:process.env.PASSPORT_SECRET||"wserjoifjpsiofjfsdfs",resave:!0,saveUninitialized:!0}));var o=require("./models/user").User;console.log(o),passport.use(new LocalStrategy(function(e,r,n){o.findOne({username:e},function(e,s){return e?n(e):s?void bcrypt.compare(r,s.password,function(e,r){return r?n(null,s):n(null,!1,{msg:"Incorrect password"})}):n(null,!1)})})),passport.serializeUser(function(e,r){r(null,e.id)}),passport.deserializeUser(function(e,s){o.findById(e,function(e,r){s(e,r)})}),e.use(passport.initialize()),e.use(passport.session()),e.post("/login",function(n,o,t){passport.authenticate("local",function(e,r,s){return e?t(e):r?void n.logIn(r,function(e){return e?(o.locals.errors=["Login failed"],t(e)):o.redirect("/")}):o.redirect("/signup")})(n,o,t)}),e.use(function(e,r,s){r.locals.currentUser=e.user,s()}),e.get("/log-out",function(e,r){e.logout(),r.redirect("signup")})};
//# sourceMappingURL=my-passport.min.js.map
